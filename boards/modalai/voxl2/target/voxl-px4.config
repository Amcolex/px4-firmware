#!/bin/sh
# PX4 commands need the 'px4-' prefix in bash.
# (px4-alias.sh is expected to be in the PATH)
. px4-alias.sh

if [ $TESTMODE = "ON" ]; then
    /bin/echo "Running self tests"
    muorb test
    MUORB_TEST_STATUS=$?
    if [ $MUORB_TEST_STATUS -ne 0 ]; then
        /bin/echo "muorb test failed"
        shutdown
        exit 0
    else
        /bin/echo "muorb test passed"
    fi
fi

muorb start

/bin/sleep 1

param select /data/px4/parameters

# Load in all of the parameters that have been saved in the file
param load

qshell icm42688p start -s

/bin/sleep 1

# Cannot enable the ESC yet. Not supported in main.
# qshell modalai_esc start

qshell crsf_rc start -d 7

/bin/sleep 1

qshell sensors start

/bin/sleep 1

qshell ekf2 start

/bin/sleep 1

qshell mc_pos_control start
/bin/sleep 1
qshell mc_att_control start
/bin/sleep 1
qshell mc_rate_control start
/bin/sleep 1
qshell mc_hover_thrust_estimator start
/bin/sleep 1
qshell land_detector start multicopter
